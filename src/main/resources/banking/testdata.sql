/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
/**
 * Author:  pedago
 * Created: 26 nov. 2019
 */
DROP TABLE CATEGORIE IF EXISTS;
DROP TABLE CLIENT IF EXISTS;
DROP TABLE COMMANDE IF EXISTS;
DROP TABLE LIGNE IF EXISTS;
DROP TABLE PRODUIT IF EXISTS;

CREATE TABLE Categorie (
	Code INT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY  ,
	Libelle VARCHAR(25) NOT NULL UNIQUE,
	Description VARCHAR(255)
);

CREATE TABLE Client (
	Code CHAR(5) NOT NULL PRIMARY KEY ,
	Societe VARCHAR(40) NOT NULL UNIQUE,
	Contact VARCHAR(30),
	Fonction VARCHAR(30) default NULL,
	Adresse VARCHAR(60) default NULL,
	Ville VARCHAR(15) default NULL,
	Region VARCHAR(15) default NULL,
	Code_postal CHAR(10) default NULL,
	Pays VARCHAR(15) default NULL,
	Telephone VARCHAR(24) default NULL,
	Fax VARCHAR(24) default NULL
);



CREATE TABLE Produit (
	Reference INT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY ,
	Nom VARCHAR(40) NOT NULL UNIQUE,
	Fournisseur INT default 0 NOT NULL ,
	Categorie INT NOT NULL REFERENCES Categorie (Code) ON DELETE RESTRICT,
	Quantite_par_unite VARCHAR(30) DEFAULT NULL,
	Prix_unitaire DECIMAL(18,2) DEFAULT 0.00 NOT NULL CHECK (Prix_unitaire >= 0),
	Unites_en_stock SMALLINT DEFAULT 0 NOT NULL  CHECK (Unites_en_stock >= 0),
	Unites_commandees SMALLINT DEFAULT 0 NOT NULL CHECK (Unites_commandees >= 0),
	Niveau_de_reappro SMALLINT DEFAULT 0 NOT NULL CHECK (Niveau_de_reappro >= 0),
	Indisponible SMALLINT DEFAULT 0 NOT NULL CHECK (Indisponible = 0 OR Indisponible = 1)
);




CREATE TABLE Commande (
	Numero INT GENERATED BY DEFAULT  AS IDENTITY NOT NULL PRIMARY KEY,
	Client CHAR(5) NOT NULL REFERENCES Client (Code) ON DELETE CASCADE,
	Saisie_le DATE default CURRENT_DATE NOT NULL,
	Envoyee_le DATE default NULL,
	Port DECIMAL(18,2) default NULL,
	Destinataire VARCHAR(40) default NULL,
	Adresse_livraison VARCHAR(60) default NULL,
	Ville_livraison VARCHAR(15) default NULL,
	Region_livraison VARCHAR(15) default NULL,
	Code_Postal_livrais VARCHAR(10) default NULL,
	Pays_Livraison VARCHAR(15) default NULL,
	Remise DECIMAL(10,2) default 0.00  NOT NULL CHECK (REMISE >= 0)
) ;



CREATE TABLE Ligne (
	Commande INT NOT NULL REFERENCES Commande (Numero) ON DELETE CASCADE,
	Produit INT NOT NULL REFERENCES Produit (Reference),
	Quantite  SMALLINT default 1 NOT NULL CHECK (Quantite > 0),
	PRIMARY KEY  (Commande, Produit)
);

INSERT INTO Categorie VALUES ( 1, 'Boissons', 'Boissons, cafés, thés, bières');
INSERT INTO Categorie VALUES ( 2, 'Condiments', 'Sauces, assaisonnements et épices');
INSERT INTO Categorie VALUES ( 3, 'Desserts', 'Desserts et friandises');
INSERT INTO Categorie VALUES ( 4, 'Produit laitiers', 'Fromages');

INSERT INTO Client VALUES ( 'ALFKI', 'Alfreds Futterkiste', 'Maria Anders', 'Représentant(e)', 'Obere Str. 57', 'Berlin', NULL, '12209', 'Allemagne', '030-0074321', '030-0076545');
INSERT INTO Client VALUES ( 'ANATR', 'Ana Trujillo Emparedados y helados', 'Ana Trujillo', 'Propriétaire', 'Avda. de la Constitución 2222', 'México D.F.', NULL, '05021', 'Mexique', '(5) 555-4729', '(5) 555-3745');
INSERT INTO Client VALUES ( 'ANTON', 'Antonio Moreno Taquería', 'Antonio Moreno', 'Propriétaire', 'Mataderos  2312', 'México D.F.', NULL, '05023', 'Mexique', '(5) 555-3932', NULL);
INSERT INTO Client VALUES ( 'AROUT', 'Around the Horn', 'Thomas Hardy', 'Représentant(e)', '120 Hanover Sq.', 'London', NULL, 'WA1 1DP', 'Royaume-Uni', '(71) 555-7788', '(71) 555-6750');
INSERT INTO Client VALUES ( 'BERGS', 'Berglunds snabbköp', 'Christina Berglund', 'Acheteur', 'Berguvsvägen  8', 'Luleå', NULL, 'S-958 22', 'Suède', '0921-12 34 65', '0921-12 34 67');


INSERT INTO Commande VALUES ( 10248, 'VINET', '1994-08-04', '1994-08-16', 161.00, 'Vins et alcools Chevalier', '59 rue de l''Abbaye', 'Reims', NULL, '51100', 'France', 0.00);
INSERT INTO Commande VALUES ( 10249, 'TOMSP', '1994-08-05', '1994-08-10', 58.00, 'Toms Spezialitäten', 'Luisenstr. 48', 'Münster', NULL, '44087', 'Allemagne', 0.00);
INSERT INTO Commande VALUES ( 10250, 'HANAR', '1994-08-08', '1994-08-12', 329.00, 'Hanari Carnes', 'Rua do Paço, 67', 'Rio de Janeiro', 'RJ', '05454-876', 'Brésil', 0.00);
INSERT INTO Commande VALUES ( 10251, 'VICTE', '1994-08-08', '1994-08-15', 206.00, 'Victuailles en stock', '2, rue du Commerce', 'Lyon', NULL, '69004', 'France', 0.00);


INSERT INTO Produit VALUES ( 1, 'Chai', 1, 1, '10 boîtes x 20 sacs', 90.00, 39, 0, 10, 0);
INSERT INTO Produit VALUES ( 2, 'Chang', 1, 1, '24 bouteilles (1 litre)', 95.00, 17, 40, 25, 0);
INSERT INTO Produit VALUES ( 3, 'Aniseed Syrup', 1, 2, '12 bouteilles (550 ml)', 50.00, 13, 70, 25, 0);
INSERT INTO Produit VALUES ( 4, 'Chef Anton''s Cajun Seasoning', 2, 2, '48 pots (6 onces)', 110.00, 53, 0, 0, 0);
INSERT INTO Produit VALUES ( 5, 'Chef Anton''s Gumbo Mix', 2, 2, '36 boîtes', 106.00, 0, 0, 0, 1);
INSERT INTO Produit VALUES ( 6, 'Grandma''s Boysenberry Spread', 3, 2, '12 pots (8 onces)', 125.00, 120, 0, 25, 0);
INSERT INTO Produit VALUES ( 7, 'Uncle Bob''s Organic Dried Pears', 3, 7, '12 cartons (1 kg)', 150.00, 15, 0, 10, 0);

INSERT INTO Ligne VALUES ( 10248, 11, 12);
INSERT INTO Ligne VALUES ( 10248, 42, 10);
INSERT INTO Ligne VALUES ( 10248, 72, 5);
INSERT INTO Ligne VALUES ( 10249, 14, 9);

COMMIT;
